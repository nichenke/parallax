#!/bin/sh
#
# Pre-commit hook: Prevent direct commits to main branch + scan for secrets
#

# Get current branch name
branch=$(git symbolic-ref --short HEAD 2>/dev/null)

# Block commits to main (no override)
if [ "$branch" = "main" ]; then
    echo "ERROR: Direct commits to main branch are not allowed."
    echo ""
    echo "Please create a feature branch:"
    echo "  git checkout -b feat/your-feature-name"
    exit 1
fi

# Scan staged files for secrets
if ! which gitleaks > /dev/null 2>&1; then
    echo "ERROR: gitleaks is not installed."
    echo "Run: make hooks"
    exit 1
fi

gitleaks protect --staged --redact --exit-code 1
